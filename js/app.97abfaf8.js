(function(){"use strict";var e={5331:function(e,t,n){var r={};n.r(r),n.d(r,{NTab:function(){return _e},PTab:function(){return Ee}});var i=n(4506),o=n.n(i),a=(n(4114),n(8111),n(2489),n(8237),n(7642),n(8004),n(3853),n(5876),n(2475),n(5024),n(1698),n(8747));Array.prototype.distinct=function(){return this.filter((e,t,n)=>n.indexOf(e)===t)},Math.wrap=function(e,t,n){const r=n-t+1,i=(e-t)%r;return i<0?n+1+i:t+i},Math.clamp=function(e,t,n){return Math.clampMax(Math.clampMin(e,t),n)},Math.clampMin=function(e,t){return Math.max(e,t)},Math.clampMax=function(e,t){return Math.min(e,t)},Array.prototype.nextSiblingIndex=function(e){const t=this.indexOf(e);if(-1===t)throw"Current item is not in array";return t===this.length-1?0:t+1},Array.prototype.nextSibling=function(e){return this[this.nextSiblingIndex(e)]},Array.prototype.previousSiblingIndex=function(e){const t=this.indexOf(e);if(-1===t)throw"Current item is not in array";return 0===t?this.length-1:t-1},Array.prototype.previousSibling=function(e){return this[this.previousSiblingIndex(e)]},a.A.sumReducer=function(e,t){return a.A.add(e,t)},a.A.prodReducer=function(e,t){return a.A.mul(e,t)},Number.sumReducer=function(e,t){return e+t},Number.prodReducer=function(e,t){return e*t},a.A.maxReducer=function(e,t){return a.A.max(e,t)},a.A.prototype.copyFrom=function(e){if(!(e instanceof a.A))throw"Copy value is not Decimal";this.sign=e.sign,this.mag=e.mag,this.layer=e.layer},window.copyToClipboard=function(){const e=document.createElement("textarea");return document.body.appendChild(e),e.style.position="absolute",e.style.left="-9999999px",e.setAttribute("readonly",""),function(t){try{return e.value=t,e.select(),document.execCommand("copy")}catch(n){return console.log(n),!1}}}(),window.funOrVal=function(e){return"function"===typeof e?e():e},String.prototype.capitalize=function(){return this.toLowerCase().replace(/^\w/u,e=>e.toUpperCase())},String.prototype.splice=function(e,t,n){return this.slice(0,e)+n+this.slice(e+Math.abs(t))},Array.range=function(e,t){return[...Array(t).keys()].map(t=>t+e)},Array.repeat=function(e,t){return Array(t).fill(e)},Array.prototype.first=function(e){if(void 0===e)return this.length>0?this[0]:void 0;if("function"!==typeof e)throw"Predicate must be a function";for(let t=0;t<this.length;t++)if(!0===e(this[t]))return this[t];throw"Array doesn't contain a matching item"},Array.prototype.last=function(e){if(void 0===e)return this.length>0?this[this.length-1]:void 0;if("function"!==typeof e)throw"Predicate must be a function";for(let t=this.length-1;t>=0;t--)if(!0===e(this[t]))return this[t];throw"Array doesn't contain a matching item"},Array.prototype.mapToObject=function(e,t){if("function"!==typeof e||"function"!==typeof t)throw"keyFun and valueFun must be functions";const n={};for(let r=0;r<this.length;++r)n[e(this[r],r)]=t(this[r],r);return n},Array.prototype.sum=function(){return 0===this.length?0:this.reduce(Number.sumReducer)},Array.prototype.max=function(){return 0===this.length?0:this.reduce((e,t)=>Math.max(e,t))},Array.prototype.min=function(){return 0===this.length?0:this.reduce((e,t)=>Math.min(e,t))},Array.prototype.countWhere=function(e){let t=0;for(const n of this)e(n)&&++t;return t},a.A.prototype.clampMaxExponent=function(e){return this.exponent>=e?a.A.fromMantissaExponent_noNormalize(1,e):this},Number.prototype.toDecimal=function(){return new a.A(this.valueOf())},Math.log4=Math.log(4),Array.prototype.randomElement=function(){return this[Math.floor(Math.random()*this.length)]},a.A.prototype.valueOf=()=>{throw new Error("Implicit conversion from Decimal to number")},a.A.prototype.copy=function(){return a.A.fromDecimal(this)},Set.prototype.countWhere=function(e){let t=0;for(const n of this)e(n)&&++t;return t},Set.prototype.find=function(e){for(const t of this)if(e(t))return t},Set.prototype.some=function(e){for(const t of this)if(e(t))return!0;return!1},Set.prototype.every=function(e){for(const t of this)if(!e(t))return!1;return!0},Set.prototype.filter=function(e){const t=new Set;for(const n of this)e(n)&&t.add(n);return t},Set.prototype.toJSON=function(){return Array.from(this)},Array.prototype.compact=function(){return this.filter(e=>void 0!==e&&null!==e)},Array.prototype.toBitmask=function(){return this.reduce((e,t)=>e|1<<t,0)},Set.prototype.toBitmask=function(){let e=0;for(const t of this)e|=1<<t;return e},Array.fromBitmask=function(e){const t=[];let n=0;while(0!==e)1&e&&t.push(n),e>>=1,++n;return t},String.isWhiteSpace=function(e){return e&&!e.trim()};var s=n(5130),c=n(144),u=n(6768),l=n(4232);n(1701),n(5367),n(2731);function h(e,t){const n=Object.entries(e),r={};for(let i=0;i<n.length;i++)r[n[i][0]]=t(n[i][1]);return{all:Object.values(r),...r}}n(7588);function f(e){return Object.keys(e).forEach(t=>{const n=e[t];"object"===typeof n&&f(n)}),Object.freeze(e)}const p=f({D0:new a.A("0"),D0_1:new a.A("0.1"),D0_2:new a.A("0.2"),D0_3:new a.A("0.3"),D0_4:new a.A("0.4"),D0_5:new a.A("0.5"),D0_6:new a.A("0.6"),D0_7:new a.A("0.7"),D0_8:new a.A("0.8"),D0_9:new a.A("0.9"),D1:new a.A("1"),D2:new a.A("2"),D3:new a.A("3"),D4:new a.A("4"),D5:new a.A("5"),D6:new a.A("6"),D7:new a.A("7"),D8:new a.A("8"),D9:new a.A("9"),D20:new a.A("20"),E1:new a.A("1e1"),E2:new a.A("1e2"),E3:new a.A("1e3"),E4:new a.A("1e4"),E5:new a.A("1e5"),E6:new a.A("1e6"),E7:new a.A("1e7"),E8:new a.A("1e8"),E9:new a.A("1e9"),E10:new a.A("1e10")}),d={NORMAL:0,STATIC:1};class g{constructor(){this._handlers={}}on(e,t,n){let r=this._handlers[e];void 0===r&&(r=[],this._handlers[e]=r),r.push({fn:t,target:n})}offAll(e){for(const t of Object.keys(this._handlers))this._handlers[t]=this._handlers[t].filter(t=>t.target!==e)}off(e){for(const t of Object.keys(this._handlers))this._handlers[t]=this._handlers[t].filter(t=>t.fn!==e)}dispatch(e,t){const n=this._handlers[e];if(void 0!==n)for(const r of n)r.fn(t)}static dispatch(e,...t){g.logic.dispatch(e,t),Fe.dispatch(e,t)}static get stats(){function e(e){return Object.values(e._handlers).map(e=>e.length).sum()}return`UI(UPDATE/Total): ${g.ui._handlers[v.UPDATE].length}/${e(g.ui)}; Logic(Total): ${e(g.logic)}`}}g.logic=new g,g.ui=new g;const v={GAME_TICK_AFTER:"GAME_TICK_AFTER",UPDATE:"UPDATE",TAB_CHANGED:"TAB_CHANGED",ENTER_PRESSED:"ENTER_PRESSED",HIDE_TOOLTIP:"HIDE_TOOLTIP",AFTER_LOADING:"AFTER_LOADING",LAYER_UNLOCKED:"LAYER_UNLOCKED",PRESTIGE_RESET:"PRESTIGE_RESET"};function y(e){currentPlayer=e}function m(){if(!currentPlayer)throw new Error("Player not initialized yet");return currentPlayer}window.currentPlayer=null;var A={id:"p",name:"P",requirement:()=>!0,checkEvent:v.AFTER_LOADING,color:"#6080f3",getPlayerData(){return{}},prestige:{startingResource:p.D0,resource:"Prestige Points",baseResource:"Points",getBaseAmount(){return m().resource},setBaseAmount(e){m().resource=e},type:d.NORMAL,requirement:p.E1,exponent:p.D0_5,gainMult:p.D1,gainExp:p.D1,resetFn(){m().resource=p.D0}},tabs:["PTab"]},E={id:"n",name:"N",requirement:()=>O.p.resource.gte(p.D20),checkEvent:v.PRESTIGE_RESET,color:"#c58937",getPlayerData(){return{}},prestige:{startingResource:p.D0,resource:"NaN Points",baseResource:"Prestige Points",getBaseAmount(){return O.p.resource},setBaseAmount(e){O.p.resource=e},type:d.NORMAL,requirement:p.D20,exponent:p.D0_1,gainMult:p.D1,gainExp:p.D1,resetFn(){O.p.resource=p.D0,m().resource=p.E1}},tabs:["NTab"]};const b={p:A,n:E},w=[["p"],["n"]],_=[["p","n"]];class S{constructor(e,t){this.config=e,this.layer=t}get currency(){return this.config.getBaseAmount()}set currency(e){this.config.setBaseAmount(e)}get type(){return this.config.type}get requirement(){return this.config.requirement}get exponent(){return this.config.exponent}get gainMult(){return this.config.gainMult}get gainExp(){return this.config.gainExp}get canReset(){return this.currency.gte(this.requirement)}gainedResourceAt(e){if(e.lt(this.resource))return p.D0;switch(this.type){case d.NORMAL:return e.div(this.requirement).pow(this.exponent).times(this.gainMult.pow(this.gainExp))}return null}requirememtAt(e){switch(this.type){case d.NORMAL:return e.div(this.gainMult.pow(this.gainExp)).root(this.exponent).times(this.requirement)}return null}get pending(){return this.gainedResourceAt(this.currency).floor()}get nextAt(){return this.requirememtAt(this.pending.add(1))}reset(){if(!this.canReset)return;const e=this.pending;this.layer.resource=this.layer.resource.add(e),this.config.resetFn(),g.dispatch(v.PRESTIGE_RESET,this.layer.id)}}const D=(0,c.Kh)({view:{modal:{queue:[],current:void 0,progressBar:void 0},layer:"",tab:0,initialized:!1}});class R{constructor(e){this.component=e.is,this.id=e.id,this.condition=e.condition}get isUnlocked(){return!this.condition||this.condition()}get isOpen(){return D.view.tab===this.id}show(){D.view.tab=this.id}}class T{constructor(e){this.config=e,g.logic.on(e.checkEvent,(...e)=>this.tryUnlock(...e)),this.prestige=new S(e.prestige,this);const t=e.tabs;this.tabs=t.map((e,t)=>new R("string"===typeof e?{is:e,id:t}:{id:t,...e}))}get isOpen(){return D.view.layer===this.id}show(){D.view.layer=this.id,this.tabs[0].show()}get id(){return this.config.id}get name(){return this.config.name}get isUnlocked(){return this.data.isUnlocked}set isUnlocked(e){this.data.isUnlocked=e}createPlayerData(){const e=this.config.getPlayerData();return e.isUnlocked=!1,e.resource=this.config.prestige.startingResource||p.D0,e}get data(){return m().layers[this.id]}get resource(){return this.data.resource}set resource(e){this.data.resource=e}tryUnlock(...e){!this.isUnlocked&&this.config.requirement(...e)&&(this.isUnlocked=!0,g.dispatch(v.LAYER_UNLOCKED))}}const O=h(b,e=>new T(e)),P={getData(){const e={};for(const t of O.all)e[t.id]=t.createPlayerData();return e}};function x(e){return O[e]}const N={ROW_HEIGHT:150,NODE_SIZE:100},k=new Map;function I(e){if(k.has(e))return k.get(e);for(let t=0;t<w.length;t++){const n=w[t].map(e=>x(e)).filter(e=>e.isUnlocked);for(let r=0;r<n.length;r++)if(n[r].id===e){const i={x:100*(r+1)/(n.length+1)+"%",y:(N.ROW_HEIGHT*t+N.NODE_SIZE).toString()};return k.set(e,i),i}}return k.set(e,null),null}function M(e){C(v.UPDATE,e),D.view.initialized&&e()}function C(e,t){const n=()=>{D.view.initialized&&t()};t&&g.ui.on(e,n),(0,u.hi)(()=>{g.ui.off(e,n)})}g.ui.on(v.LAYER_UNLOCKED,()=>k.clear());var L={__name:"LayerNode",props:{layer:{type:Object,required:!0}},setup(e){const t=e,n=t.layer,r=(0,u.EW)(()=>n.name),i=(0,u.EW)(()=>I(n.id)),o=(0,u.EW)(()=>({"--node-color":n.config.color,left:i.value.x,top:`${i.value.y}px`})),a=(0,c.KR)(!1);function s(){n.show()}function h(){a.value=n.isUnlocked}return M(h),(e,t)=>a.value?((0,u.uX)(),(0,u.CE)("button",{key:0,class:"layer-node",style:(0,l.Tr)(o.value),onClick:s},(0,l.v_)(r.value),5)):(0,u.Q3)("",!0)}},F=n(1241);const j=(0,F.A)(L,[["__scopeId","data-v-87da4cbe"]]);var W=j;n(1148);const U=["x1","y1","x2","y2"];var $={__name:"NodeConnection",props:{connection:{type:Array,required:!0}},setup(e){const t=e,n=(0,u.EW)(()=>I(t.connection[0])),r=(0,u.EW)(()=>I(t.connection[1])),i=(0,c.KR)(!1);function o(){i.value=t.connection.every(e=>x(e).isUnlocked)}return M(o),(e,t)=>i.value?((0,u.uX)(),(0,u.CE)("line",{key:0,x1:n.value.x,y1:n.value.y,x2:r.value.x,y2:r.value.y,class:"line-style"},null,8,U)):(0,u.Q3)("",!0)}};const G=(0,F.A)($,[["__scopeId","data-v-4284c120"]]);var X=G;const K={class:"tree-layout"},q={class:"layer-svg"},B={class:"layer-node-container"};var z={__name:"TreeLayout",setup(e){const t=O.all,n=(0,u.EW)(()=>_);return(e,r)=>((0,u.uX)(),(0,u.CE)("div",K,[((0,u.uX)(),(0,u.CE)("svg",q,[((0,u.uX)(!0),(0,u.CE)(u.FK,null,(0,u.pI)(n.value,(e,t)=>((0,u.uX)(),(0,u.Wv)((0,c.R1)(X),{key:t+"-connection",connection:e},null,8,["connection"]))),128))])),(0,u.Lk)("div",B,[((0,u.uX)(!0),(0,u.CE)(u.FK,null,(0,u.pI)((0,c.R1)(t),e=>((0,u.uX)(),(0,u.Wv)((0,c.R1)(W),{key:e.id,layer:e},null,8,["layer"]))),128))])]))}};const H=(0,F.A)(z,[["__scopeId","data-v-486ce37f"]]);var Y=H;const V={EXP_NOMANTISSA:new a.A("1e1000000"),EXP_WITH_MANTISSA:new a.A("1e10000"),EXP_STANDARD:new a.A(1e9),COMMA:new a.A(1e3),SMALL:new a.A(1e-4),SLOG_UPPER:new a.A("eeee1000")};function J(e){return e.gte(1e9)?te(e,3):e.gte(1e4)?Z(e,0):e.toStringWithDecimalPlaces(0)}function Q(e,t,n=!0){const r=e.log10().floor();let i=e.div(a.A.pow10(r));"10"===i.toStringWithDecimalPlaces(t)&&(i=new a.A(1),r.add(1));const o=J(r,t);return n?`${i.toStringWithDecimalPlaces(t)}e${o}`:`e${o}`}function Z(e,t){if(null===e)return"NaN";if(e.mag<.001)return(0).toFixed(t);const n=e.toStringWithDecimalPlaces(t),r=n.split(".");return r[0]=r[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/gu,"$1,"),1===r.length?r[0]:`${r[0]}.${r[1]}`}function ee(e,t){if(null===e)return"NaN";if(e.mag<1e-4)return(0).toFixed(t);let n=t;return e.mag<.1&&0!==t&&(n=Math.max(t,4)),e.toStringWithDecimalPlaces(n)}function te(e,t=2,n=!1){const r=a.A.fromValue_noAlloc(e);if(isNaN(r.sign)||isNaN(r.layer)||isNaN(r.mag))return player.hasNaN=!0,"NaN";if(r.sign<0)return`-${te(r.neg(),t,n)}`;if(r.mag===Number.POSITIVE_INFINITY)return"Infinity";if(r.gte(V.SLOG_UPPER)){const e=r.slog();if(e.gte(1e6))return`F${te(e.floor())}`;const t=a.A.pow(10,e.sub(e.floor()));return`${t.toStringWithDecimalPlaces(3)}F${Z(e.floor(),0)}`}return r.gte(V.EXP_NOMANTISSA)?Q(r,0,!1):r.gte(V.EXP_WITH_MANTISSA)?Q(r,0,!0):r.gte(V.EXP_STANDARD)?Q(r,t,!0):r.gte(V.COMMA)?Z(r,0):r.gte(V.SMALL)||!n?ee(r,t):r.eq(0)?(0).toFixed(t):ne(r,t)}function ne(e,t){const n=re(e);if(n.lt(Infinity)){const e=Q(n,t);return e.replace(/([^(?:e|F)]*)$/u,"-$1")}return`${te(n,t)}⁻¹`}function re(e){const t=e.log10().ceil(),n=e.div(a.A.pow(10,t)),r=t.neg();return a.A.pow(10,r).times(n)}const ie=Object.freeze({name:"The ??? Tree",author:"nobody",resourceName:"Points",discordName:"",discordLink:"",startingResource:new a.A(10),versionDisplay:"0.0",version:0,versionTitle:"Literally nothing"}),oe={class:"info"},ae={class:"res-accent"};var se={__name:"HeaderInfo",setup(e){const t=(0,c.KR)(new a.A(0));function n(){t.value.copyFrom(m().resource)}M(n);const r=ie.resourceName;return(e,n)=>((0,u.uX)(),(0,u.CE)("div",oe,[(0,u.Lk)("div",null,[n[0]||(n[0]=(0,u.eW)("You have ",-1)),(0,u.Lk)("span",ae,(0,l.v_)((0,c.R1)(te)(t.value)),1),(0,u.eW)(" "+(0,l.v_)((0,c.R1)(r))+".",1)])]))}};const ce=se;var ue=ce;const le={class:"info"};var he={__name:"MainDisplay",props:{layer:{type:Object,required:!0}},setup(e){const t=e,n=t.layer,r=(0,u.EW)(()=>n.config.color),i=(0,c.KR)(new a.A(0)),o=(0,u.EW)(()=>n.config.prestige.resource);function s(){i.value.copyFrom(n.resource)}M(s);const h=(0,u.EW)(()=>({color:r.value}));return(e,t)=>((0,u.uX)(),(0,u.CE)("div",le,[t[0]||(t[0]=(0,u.eW)("You have ",-1)),(0,u.Lk)("span",{style:(0,l.Tr)(h.value)},(0,l.v_)((0,c.R1)(te)(i.value)),5),(0,u.eW)(" "+(0,l.v_)(o.value)+".",1)]))}};const fe=he;var pe=fe;const de={class:"info"};var ge={__name:"ResetButton",props:{layer:{type:Object,required:!0}},setup(e){const t=e,n=t.layer,r=n.prestige,i=(0,u.EW)(()=>n.config.color),o=(0,c.KR)(new a.A(0)),s=(0,c.KR)(new a.A(0)),h=(0,c.KR)(new a.A(0)),f=(0,u.EW)(()=>n.config.prestige.baseResource),p=(0,u.EW)(()=>n.config.prestige.resource),d=(0,c.KR)(!1),g=(0,u.EW)(()=>({"reset-btn":!0,"reset-btn--available":d.value})),v=(0,u.EW)(()=>({"--color-layer":i.value}));function y(){d.value=r.canReset,o.value.copyFrom(r.currency),h.value.copyFrom(r.pending),s.value.copyFrom(r.nextAt)}function m(){r.reset()}return M(y),(e,t)=>((0,u.uX)(),(0,u.CE)("div",null,[(0,u.Lk)("button",{style:(0,l.Tr)(v.value),class:(0,l.C4)(g.value),onClick:m},[(0,u.Lk)("span",null,"Reset for +"+(0,l.v_)((0,c.R1)(te)(h.value,0))+" "+(0,l.v_)(p.value),1),t[0]||(t[0]=(0,u.Lk)("br",null,null,-1)),(0,u.Lk)("span",null,"Next at: "+(0,l.v_)((0,c.R1)(te)(s.value))+" "+(0,l.v_)(f.value),1)],6),(0,u.Lk)("div",de,"You have "+(0,l.v_)((0,c.R1)(te)(o.value))+" "+(0,l.v_)(f.value)+".",1)]))}};const ve=(0,F.A)(ge,[["__scopeId","data-v-be3b6926"]]);var ye=ve,me={__name:"PTab",setup(e){const t=(0,u.EW)(()=>O.p);return(e,n)=>((0,u.uX)(),(0,u.CE)("div",null,[(0,u.bF)((0,c.R1)(pe),{layer:t.value},null,8,["layer"]),(0,u.bF)((0,c.R1)(ye),{layer:t.value},null,8,["layer"])]))}};const Ae=me;var Ee=Ae,be={__name:"NTab",setup(e){const t=(0,u.EW)(()=>O.n);return(e,n)=>((0,u.uX)(),(0,u.CE)("div",null,[(0,u.bF)((0,c.R1)(pe),{layer:t.value},null,8,["layer"]),(0,u.bF)((0,c.R1)(ye),{layer:t.value},null,8,["layer"])]))}};const we=be;var _e=we;const Se={class:"game-tab"};var De={__name:"GameTab",setup(e){const t=(0,u.EW)(()=>O[D.view.layer]),n=(0,u.EW)(()=>t.value.tabs[D.view.tab]);return(e,t)=>((0,u.uX)(),(0,u.CE)("div",Se,[((0,u.uX)(),(0,u.Wv)((0,u.$y)(r[n.value.component])))]))}};const Re=(0,F.A)(De,[["__scopeId","data-v-9bb7bf8e"]]);var Te=Re;const Oe={key:0,class:"game-ui"},Pe={key:0,class:"game-panel"},xe={key:1,class:"game-panel"},Ne=!1;var ke={__name:"GameUIComponent",setup(e){const t=(0,u.EW)(()=>""!==D.view.layer);return(e,n)=>(0,c.R1)(D).view.initialized?((0,u.uX)(),(0,u.CE)("div",Oe,[Ne&&t.value?(0,u.Q3)("",!0):((0,u.uX)(),(0,u.CE)("div",Pe,[(0,u.bF)((0,c.R1)(ue)),(0,u.bF)((0,c.R1)(Y))])),t.value?((0,u.uX)(),(0,u.CE)("div",xe,[(0,u.bF)((0,c.R1)(Te)),(0,u.Lk)("div",{class:"back-btn",onClick:n[0]||(n[0]=e=>(0,c.R1)(D).view.layer="")}," ← ")])):(0,u.Q3)("",!0)])):(0,u.Q3)("",!0)}};const Ie=(0,F.A)(ke,[["__scopeId","data-v-701aaf76"]]);var Me=Ie;const Ce=!1;console.log(s.Ef);const Le={complain(){this.checkReactivity(m(),"player")},checkReactivity(e,t){if(void 0!==e&&null!==e){if(void 0!==e.__ob__)throw new Error(`Boi you fukked up - ${t} became REACTIVE (oh shite)`);for(const n in e){if(!Object.prototype.hasOwnProperty.call(e,n))continue;const r=e[n];"object"===typeof r&&this.checkReactivity(r,`${t}.${n}`)}}}},Fe={events:[],flushPromise:void 0,initialized:!1,dispatch(e,t){const n=this.events.indexOf(e);-1!==n&&this.events.splice(n,1),e!==v.UPDATE&&this.events.push([e,t]),this.flushPromise||(this.flushPromise=Promise.resolve().then(this.flushEvents.bind(this)))},flushEvents(){this.flushPromise=void 0;for(const e of this.events)g.ui.dispatch(e[0],e[1]);g.ui.dispatch(v.UPDATE),Ce&&Le.complain(),this.events=[]},update(){this.dispatch(v.UPDATE)}},je=(0,s.Ef)(Me);je.mount("#ui");n(3110);class We{constructor(e){this._getValue=e,We.registerLazy(this)}static get registrar(){return void 0===We._registrar&&(We._registrar=[]),We._registrar}static registerLazy(e){We.registrar.push(e)}static invalidateAll(){for(const e of We.registrar)e.invalidate()}get value(){return void 0===this._value&&(this._value=this._getValue()),this._value}invalidate(){this._value=void 0}invalidateOn(...e){for(const t of e)EventHub.logic.on(t,()=>this.invalidate());return this}}function Ue(e){return Array.isArray(e)?[]:{}}function $e(e,t){return e instanceof a.A?new a.A(e):e instanceof Set?new Set(e):!1!==t.clone&&t.isMergeableObject(e)?Ke(Ue(e),e,t):e}function Ge(e,t,n){return e.concat(t).map(e=>$e(e,n))}function Xe(e,t,n){const r={};return n.isMergeableObject(e)&&Object.keys(e).forEach(t=>{r[t]=$e(e[t],n)}),Object.keys(t).forEach(i=>{e[i]&&e[i]instanceof a.A?r[i]=new a.A(t[i]):e[i]&&e[i]instanceof Set?r[i]=new Set(t[i]):n.isMergeableObject(t[i])&&e[i]?r[i]=Ke(e[i],t[i],n):r[i]=$e(t[i],n)}),r}function Ke(e,t,n={}){if(n.arrayMerge=n.arrayMerge||Ge,n.isMergeableObject=n.isMergeableObject||Be,e instanceof a.A)return new a.A(t);if(e instanceof Set)return new Set(t);const r=Array.isArray(t),i=Array.isArray(e),o=r===i;return o?r?n.arrayMerge(e,t,n):Xe(e,t,n):$e(t,n)}function qe(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");if(!t){const e=(e,t,n)=>t.map((t,r)=>e[r]&&e[r]instanceof a.A?new a.A(t):e[r]&&e[r]instanceof Set?new Set(t):n.isMergeableObject(t)&&e[r]?Ke(e[r],t,n):$e(t,n));t={arrayMerge:e}}return e.reduce((e,n)=>Ke(e,n,t),{})}function Be(e){return ze(e)&&!He(e)}function ze(e){return Boolean(e)&&"object"===typeof e}function He(e){const t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t}function Ye(){return{options:{currentTab:"",currentSubtab:""},lastUpdate:Date.now(),resource:a.A.fromValue_noAlloc(ie.startingResource),version:ie.version,layers:P.getData()}}let Ve=Ye();function Je(){y(Ve)}function Qe(){Ve=qe([{},Ye()]),Je()}function Ze(e){Ve=e,Je()}n(116);const et={patches:{},prePatch(e){e.version=e.version||0},patch(e,t){this.prePatch(e);const n=qe([Ye(),e]),r=Object.keys(this.patches).map(parseFloat).sort();let i;while(void 0!==(i=r.find(e=>n.version<e&&e<t))){const e=this.patches[i];e(n),n.version=i}return n},patchPlayer(e){return this.patch(e,Object.keys(et.patches).map(parseFloat).max()+1)}};n(6573),n(8100),n(7936),n(9112),n(9577),n(6632),n(4226),n(9486),n(456),n(4979);var tt=n(2188);function nt(e){const t=window.atob(e).split("").map(e=>e.charCodeAt(0)),n=new Uint8Array(t);return tt.Ay.inflate(n,{to:"string"})}function rt(e){return window.btoa(String.fromCharCode.apply(null,tt.Ay.deflate(e,{gzip:!0})))}const it={fileStart:"TheModdingTreeSaveFileAAA",fileEnd:"EndOfSaveFile",encode(e){return`${this.fileStart}${rt(e).replace(/0/gu,"0a").replace(/(\+)/gu,"0b").replace(/(\/)/gu,"0c")}${this.fileEnd}`},decode(e){try{return JSON.parse(nt(e.slice(this.fileStart.length,-this.fileEnd.length).replace(/0c/gu,"/").replace(/0b/gu,"+").replace(/0a/gu,"0")))}catch{return}}};function ot(){return m().layers.p.resource}const at={interval:null,devSpeed:1,get updateRate(){return Ve.options.updateRate},set updateRate(e){Ve.options.updateRate=e,this.restart()},start(){if(null!==this.interval)throw new Error("GameLoop has already started.");this.interval=setInterval(()=>this.tick(),this.updateRate)},stop(){null!==this.interval&&(clearInterval(this.interval),this.interval=null)},restart(){this.stop(),this.start()},tick(e){let t=e??Date.now()-Ve.lastUpdate;Ve.lastUpdate+=t;Ce&&(t*=this.devSpeed);const n=t/1e3;Ve.resource=Ve.resource.add(ot().times(n)),Fe.update(),g.dispatch(v.GAME_TICK_AFTER)}},st={_enabled:!0,get enabled(){return this._enabled},set enabled(e){this._enabled=e},runForTime(e,t,n){const r=n.batchSize||1,i=n.maxTime,o=Date.now();for(let a=t;a>0;){for(let t=0;t<Math.min(a,r);++t)e(a),--a;if(Date.now()-o>=i)return a}return 0},sleepPromise:e=>new Promise(t=>setTimeout(t,e)),run(e,t,n){if(this.enabled){this.enabled=!1;const r=this._run(e,t,n);return n.then?r.then(()=>{n.then(),this.enabled=!0}):r}for(let r=0;r<t;++r)e(r);n.then&&n.then()},async _run(e,t,n){n.progress||(n.progress={}),n.progress.maxIter=t,n.progress.remaining=this.runForTime(e,n.progress.maxIter,n);const r=n.sleepTime||1;if(n.progress.remaining){n.asyncEntry&&n.asyncEntry(n.progress.maxIter-n.progress.remaining);do{await this.sleepPromise(r),n.progress.remaining=this.runForTime(e,n.progress.remaining,n),n.asyncProgress&&n.asyncProgress(n.progress.maxIter-n.progress.remaining)}while(n.progress.remaining>0);n.asyncExit&&n.asyncExit()}}};function ct(e,t=!1){if(e<0)return;let n=Math.floor(20*e);const r=Math.min(1e3*e/33,1e5);n>r&&!t?n=r:n>50&&t&&(n=50);const i=qe([{},m()]);let o=e;const a=e=>{const t=o/e;at.tick(1e3*t),o-=t};if(t){at.stop();for(let e=50;e>0;e--)a(e)}else{const t={};D.view.modal.progressBar={},st.run(a,n,{batchSize:1,maxTime:60,sleepTime:1,asyncEntry:e=>{at.stop(),D.view.modal.progressBar={label:"Calculating Offline Simulations",current:e,max:n,startTime:Date.now(),buttons:[{text:"Speed Up",condition:(e,t)=>t-e>500,click:()=>{const e=Math.clampMin(Math.floor(t.remaining/2),500);t.maxIter-=t.remaining-e,t.remaining=e,D.view.modal.progressBar.max=t.maxIter}},{text:"Skip",condition:(e,t)=>t-e>10,click:()=>{t.maxIter-=t.remaining-10,t.remaining=10}}]}},asyncProgress:e=>{D.view.modal.progressBar.current=e},asyncExit:()=>{D.view.modal.progressBar=void 0,at.start()},then:()=>{ut(e,i)},progress:t})}}function ut(){lt.save()}const lt={saveInterval:2e4,get timeSinceLastSave(){return this._timeSinceLastSave},set timeSinceLastSave(e){this._timeSinceLastSave=e,this._timeSinceLastSave>=this.saveInterval&&this.save()},get saveKey(){return Ce?"tmtr-dev-save":"tmtr-save"},init(){const e=localStorage.getItem(this.saveKey);null===e?this.updatePlayerData():this.importSave(e),setInterval(()=>this.save(),this.saveInterval)},importFromJSON(e){at.stop();const t=e;Ze(et.patchPlayer(t)),this.updatePlayerData()},exportToClipboard(){copyToClipboard(it.encode(JSON.stringify(Ve))),GameUI.notify.info("")},importSave(e){try{this.importFromJSON(it.decode(e))}catch(t){console.log(t)}},get canSave(){return!0},save(){this.canSave&&(localStorage.setItem(this.saveKey,it.encode(JSON.stringify(Ve))),this._timeSinceLastSave=0,this.hasSaved=!0)},hardReset(){Qe(),Ve.lastUpdate=Date.now(),this.save(),this.updatePlayerData()},updatePlayerData(){Je(),We.invalidateAll();const e=Date.now()-Ve.lastUpdate;e>1e4?ct(e/1e3):(at.restart(),this.save()),g.dispatch(v.AFTER_LOADING)},checkPlayerObject(e){if(void 0===e||null===e)return"Save decoding failed (invalid format)";if(void 0===e.mass)return"Save does not have mass property";const t=[];function n(e,r){let i=!1;for(const o in e){const a=e[o];let s;switch(typeof a){case"object":s=n(a,`${r}.${o}`),i=i||s;break;case"number":s=Number.isNaN(a),i=i||s,s&&t.push(`${r}.${o}`);break;case"string":s="NaN"===a,i=i||s,s&&t.push(`${r}.${o}`);break}}return i}return n(e,"player"),0===t.length?"":`${quantify("NaN player property",t.length)} found:\n      ${t.join(", ")}`}};Error;const ht={handled:!1,cleanStart:!1,onerror(e){this.handled||(this.handled=!0,this.cleanStart?(this.stopGame(),this.crash(e)):requestAnimationFrame(()=>this.crash(e)))},stopGame(){function e(e,t){let n=e(()=>{},9999);while(n--)t(n)}GameKeyboard.disable(),GameIntervals.stop(),e(setInterval,clearInterval),e(setTimeout,clearTimeout),e(requestAnimationFrame,cancelAnimationFrame)},crash(e){Fe.initialized&&alert(e)}};function ft(){lt.init()}function pt(){const e=window.location.href;return e.includes("file")||e.includes("127.0.0.1")||e.includes("localhost")||e.includes("8080")}window.onerror=(e,t)=>{t.endsWith(".js")&&ht.onerror(e)},window.onload=function(){Fe.initialized=!0,D.view.initialized=!0,document.title=ie.name},pt()&&o().init(),ft()}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}n.m=e,function(){var e=[];n.O=function(t,r,i,o){if(!r){var a=1/0;for(l=0;l<e.length;l++){r=e[l][0],i=e[l][1],o=e[l][2];for(var s=!0,c=0;c<r.length;c++)(!1&o||a>=o)&&Object.keys(n.O).every(function(e){return n.O[e](r[c])})?r.splice(c--,1):(s=!1,o<a&&(a=o));if(s){e.splice(l--,1);var u=i();void 0!==u&&(t=u)}}return t}o=o||0;for(var l=e.length;l>0&&e[l-1][2]>o;l--)e[l]=e[l-1];e[l]=[r,i,o]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};n.O.j=function(t){return 0===e[t]};var t=function(t,r){var i,o,a=r[0],s=r[1],c=r[2],u=0;if(a.some(function(t){return 0!==e[t]})){for(i in s)n.o(s,i)&&(n.m[i]=s[i]);if(c)var l=c(n)}for(t&&t(r);u<a.length;u++)o=a[u],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(l)},r=self["webpackChunktmtr"]=self["webpackChunktmtr"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var r=n.O(void 0,[504],function(){return n(5331)});r=n.O(r)})();
//# sourceMappingURL=app.97abfaf8.js.map